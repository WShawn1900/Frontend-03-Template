# HTTP请求 ｜HTTP协议解析

##ISO-OSI 七层网络模型呢
由底层到顶层分别为：




应用
表示      ->      HTTP
会话

传输      ->      TCP

网络      ->     internet

数据链路    ->    4G\5G WIFI
物理层



##TCP IP基础知识
>都是全双工协议

###IP：连入`internet`每台设备的地址。  

* 包
* IP 地址
* libnet（构造包）/libpcap（从网卡抓包） （C++）


###TCP
>面向连接的协议，需要双方连接的状态。

TCP关键问题
* 连接维护：三次握手，建立连接。四次握手，关闭连接。
* 顺序问题：TCP 包头部格式中的序号（32位），对包进行编号。
* 流量控制：包头部中窗口大小（16位），表明自身吞吐量。
* 拥塞机制：依据状态，控制发包速度。
* 丢包问题：不断重复发送。

相关术语：
* 流：没有明确数据格式，只要保证前后首尾相接。
* 端口：网卡根据端口将接受到的数据包分配给对应的应用
* require('net')：node 中 TCP 的封装

##HTTP
>基于TCP的文本型协议

特点
* 无连接
* 无状态


###Request报文格式
![报文组成格式](media/10ff27d1032bf32393195f23ef2f9874.jpg)

#### 1. 请求行

| 请求方法 | sp(空格) | URL | sp | HTTP版本 | cr(回车)|lf(换行)|
|------|----|-----|-------|----|----|----|

请求方法：
* POST：上传数据
* GET：获取资源
* PUT：指定资源位置上传最新数据。（标实生产、测试服务）
* DELETE：删除资源

URL
* 服务地址

HTTP版本
* 使用协议版本

sp、cr、lf
* 用于文本解析

####2. 首部行
> 以键值对(key:value)格式，存储重要信息。

| 字段名称: | sp | 字段值 | cr | lf |
|:------|:---|:----|:---|:---|

首部内容：
* Accept-Charset：客户端可接受字符集
* Content-Type：body 数据格式
* Cache-Control：`max-age=<seconds>` [详情...](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control)

####3. 正文body
按照`Content-Type`规定的数据主体。

### Respones 报文
![报文组成格式](media/1c2cfd4326d0dfca652ac8501321fac1.jpg)

#### 1.状态行

| 版本 | Sp | 状态码 | Sp | 短语 | Cr | Lf |
|----|----|-----|----|----|----|----|

#####状态码：
* 1** ：服务端收到请求、需要请求者继续执行操作。
    1. 100：继续
    2. 101：切换协议

* 2** ：成功
    1. 200：请求成功
    2. 201：请求成功创建新资源
    3. 202：已接受，但未处理完成
    4. 203：非授权信息，
    5. 204：无内容
    6. 205：重置内容
    7. 206：服务器成功处理部分内容

* 3** ：重定向。
    1. 301：请求资源被永久移动新的 URL
    2. 302：临时移动
    3. 303：查看其他地址
    4. 304：未修改
    5. 305：需要通过代理访问资源
    6. 307：临时重定向

* 4** ：客户端错误
    1. 400：客户端请求语法错误
    2. 401：权限验证未通过
    3. 403：服务端拒绝执行请求
    4. 404：找不到资源
    5. 405：请求方法被禁止
    6. 406：后台返回结果前端无法解析
    7. 407：需要使用代理授权
    8. 408：请求超时
    9. 409：服务器完成客户端的 PUT 请求时可能返回此代码，服务器处理请求时发生了冲突
    10. 410：请求资源不存在
    11. 411：服务端无法处理不带`Content-Length`数据
    12. 412：客户端请求信息的先决条件错误
    13. 413：请求实体过大
    14. 414：URL过长
    15. 415：服务器无法处理请求附带的媒体格式
    16. 416：请求范围无效
    17. 417：服务器无法满足Expect的请求头信息

* 5** ：服务端错误
    1. 501：服务端不支持请求功能
    2. 502：网关错误
    3. 503：系统维护，服务不可用
    4. 504：网关超时
    5. 505：不支持HTTP版本


#### 2.首部行
同`request`一致


#### 3.正文  
同`request`一致